<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data Preparation</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PhD+ Module: Data Science Essentials in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="intror.html">1. Intro to R</a>
</li>
<li>
  <a href="dataprep.html">2. Data Prep</a>
</li>
<li>
  <a href="dataviz.html">3. Data Viz</a>
</li>
<li>
  <a href="linearmodel.html">4. Linear Models</a>
</li>
<li>
  <a href="modelviz.html">5. Model Viz</a>
</li>
<li>
  <a href="shinyr.html">6. Interactive Viz</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data Preparation</h1>

</div>


<div id="get-ready" class="section level1">
<h1>Get Ready!</h1>
<ul>
<li>Download the data files and R scripts:
<ul>
<li><a href="https://github.com/uvastatlab/phdplus/blob/master/dataprepR.zip">Go to GitHub</a>, and click “Download”. The folder containstwo data files (CAMA_CardLevelData.txt, CAMA_ParcelInfo.txt) and an R script (data_prep.R).</li>
<li>Unzip it and put it somwehere you can locate it on your machine.</li>
</ul></li>
</ul>
</div>
<div id="the-data" class="section level1">
<h1>The Data</h1>
<p>We’ll be working with real estate data from Albemarle county <a href="http://www.albemarle.org/department.asp?department=gds&amp;relpage=3914#Parcels">Office of Geographic Data Services</a>, though the links are not currently visible.</p>
<p>The data includes</p>
<ul>
<li><a href="CAMA_CardLevelData.txt.htm">Real Estate Information - Primary Card Level Data</a></li>
<li><a href="CAMA_ParcelInfo.txt.htm">Real Estate Information - Parcel Level Data</a></li>
</ul>
<p>We’ll be using this data to understand more about housing assessments and value, so we’ll focus on properties that are inhabited as homes.</p>
</div>
<div id="data-preparation-and-tidy-data" class="section level1">
<h1>Data Preparation and Tidy Data</h1>
<p>Data is usually messy and requires preparation (aka cleaning, wrangling, munging). You can approach data preparation as tedious <a href="https://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html">“janitorial work”</a><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> or as an opportunity to really get to know your data – it’s possibility and limitations, quirks and errors. We’ll use the Albemarle County Real Estate data to as an in-depth example, getting it ready for more complex visualizations and analysis to come.</p>
<p>Before we dive in with the data, let’s get to know the <code>dplyr</code> package. Part of the the <a href="https://www.tidyverse.org/"><code>tidyverse</code></a>, <a href="https://dplyr.tidyverse.org/"><code>dplyr</code></a> is a package for data manipulation. The package implements a <em>grammar</em> for transforming data, based on verbs/functions that define a set of common tasks.</p>
<div id="functionsverbs" class="section level2">
<h2>Functions/Verbs</h2>
<p><code>dplyr</code> functions are for <code>d</code>ata frames</p>
<ul>
<li>first argument of <code>dplyr</code> functions is always a data frame</li>
<li>followed by function specific arguments that detail what to do</li>
<li>returns a data frame</li>
</ul>
</div>
</div>
<div id="dplyr-isolating-data" class="section level1">
<h1>dplyr: Isolating data</h1>
<center>
<p><span class="math inline">\(\color{blue}{\text{select()}}\)</span> - extract <span class="math inline">\(\color{blue}{\text{variables}}\)</span></p>
<p><span class="math inline">\(\color{green}{\text{filter()}}\)</span> - extract <span class="math inline">\(\color{green}{\text{rows}}\)</span></p>
<p><span class="math inline">\(\color{green}{\text{arrange()}}\)</span> - reorder <span class="math inline">\(\color{green}{\text{rows}}\)</span></p>
</center>
<p>Let’s look at some quick examples using the Albemarle <code>homes</code> data .</p>
<pre class="r"><code>library(tidyverse)
options(tibble.print_min = 5)

homes &lt;- read_csv(&quot;https://raw.githubusercontent.com/uvastatlab/phdplus/master/data/albemarle_homes.csv&quot;)
homes</code></pre>
<pre><code>## # A tibble: 32,746 x 26
##   tmp   yearbuilt yearremodeled usecode condition finsqft cooling fp_num
##   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1 0060…      2006             0 Single… Average      1922 Centra…      1
## 2 0060…      2003             0 Single… Average      1848 Centra…      0
## 3 0070…      1974             0 Single… Average      1368 No Cen…      0
## 4 0070…      1954             0 Single… Average      1092 No Cen…      0
## 5 0070…      1987             0 Single… Average      1344 Centra…      0
## # … with 3.274e+04 more rows, and 18 more variables: bedroom &lt;dbl&gt;,
## #   fullbath &lt;dbl&gt;, halfbath &lt;dbl&gt;, totalrooms &lt;dbl&gt;, city &lt;chr&gt;,
## #   zip &lt;dbl&gt;, lotsize &lt;dbl&gt;, landvalue &lt;dbl&gt;, improvementsvalue &lt;dbl&gt;,
## #   totalvalue &lt;dbl&gt;, lastsaleprice &lt;dbl&gt;, lastsaledate &lt;dttm&gt;, age &lt;dbl&gt;,
## #   med_age &lt;dbl&gt;, fp &lt;dbl&gt;, landuse &lt;dbl&gt;, insub &lt;dbl&gt;, remode &lt;dbl&gt;</code></pre>
<div id="select" class="section level2">
<h2>select()</h2>
<p>Extract columns by name</p>
<pre class="r"><code>select(homes, totalvalue)</code></pre>
<pre><code>## # A tibble: 32,746 x 1
##   totalvalue
##        &lt;dbl&gt;
## 1     409900
## 2     523100
## 3     228800
## 4     177900
## 5     232400
## # … with 3.274e+04 more rows</code></pre>
<pre class="r"><code>select(homes, totalvalue, city)</code></pre>
<pre><code>## # A tibble: 32,746 x 2
##   totalvalue city  
##        &lt;dbl&gt; &lt;chr&gt; 
## 1     409900 CROZET
## 2     523100 CROZET
## 3     228800 OTHER 
## 4     177900 OTHER 
## 5     232400 OTHER 
## # … with 3.274e+04 more rows</code></pre>
<p>select() helpers include</p>
<ul>
<li>select(.data, <strong>var1:var10</strong>): select range of columns</li>
<li>select(.data, <strong>-c(var1, var2)</strong>): select every column but</li>
<li>select(.data, <strong>starts_with(“string”)</strong>): select columns that start with…</li>
<li>select(.data, <strong>contains(“string”)</strong>): select columns whose names contain…</li>
</ul>
<pre class="r"><code>select(homes, finsqft:fp_num)</code></pre>
<pre><code>## # A tibble: 32,746 x 3
##   finsqft cooling        fp_num
##     &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
## 1    1922 Central Air         1
## 2    1848 Central Air         0
## 3    1368 No Central Air      0
## 4    1092 No Central Air      0
## 5    1344 Central Air         0
## # … with 3.274e+04 more rows</code></pre>
<pre class="r"><code>select(homes, -c(finsqft:fp_num))</code></pre>
<pre><code>## # A tibble: 32,746 x 23
##   tmp   yearbuilt yearremodeled usecode condition bedroom fullbath halfbath
##   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 0060…      2006             0 Single… Average         3        3        0
## 2 0060…      2003             0 Single… Average         3        2        0
## 3 0070…      1974             0 Single… Average         3        1        0
## 4 0070…      1954             0 Single… Average         4        1        0
## 5 0070…      1987             0 Single… Average         3        2        0
## # … with 3.274e+04 more rows, and 15 more variables: totalrooms &lt;dbl&gt;,
## #   city &lt;chr&gt;, zip &lt;dbl&gt;, lotsize &lt;dbl&gt;, landvalue &lt;dbl&gt;,
## #   improvementsvalue &lt;dbl&gt;, totalvalue &lt;dbl&gt;, lastsaleprice &lt;dbl&gt;,
## #   lastsaledate &lt;dttm&gt;, age &lt;dbl&gt;, med_age &lt;dbl&gt;, fp &lt;dbl&gt;,
## #   landuse &lt;dbl&gt;, insub &lt;dbl&gt;, remode &lt;dbl&gt;</code></pre>
<pre class="r"><code>select(homes, contains(&quot;year&quot;))</code></pre>
<pre><code>## # A tibble: 32,746 x 2
##   yearbuilt yearremodeled
##       &lt;dbl&gt;         &lt;dbl&gt;
## 1      2006             0
## 2      2003             0
## 3      1974             0
## 4      1954             0
## 5      1987             0
## # … with 3.274e+04 more rows</code></pre>
</div>
<div id="filter" class="section level2">
<h2>filter()</h2>
<p>Extract rows that meet logical condition</p>
<pre class="r"><code>filter(homes, yearbuilt == 2016)</code></pre>
<pre><code>## # A tibble: 351 x 26
##   tmp   yearbuilt yearremodeled usecode condition finsqft cooling fp_num
##   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1 0100…      2016             0 Single… Good         2842 Centra…      1
## 2 060K…      2016             0 Single… None         2766 Centra…      1
## 3 060L…      2016             0 Single… Average      2271 Centra…      1
## 4 061A…      2016             0 Single… Average      1880 Centra…      0
## 5 032G…      2016             0 Single… Good         2496 Centra…      0
## # … with 346 more rows, and 18 more variables: bedroom &lt;dbl&gt;,
## #   fullbath &lt;dbl&gt;, halfbath &lt;dbl&gt;, totalrooms &lt;dbl&gt;, city &lt;chr&gt;,
## #   zip &lt;dbl&gt;, lotsize &lt;dbl&gt;, landvalue &lt;dbl&gt;, improvementsvalue &lt;dbl&gt;,
## #   totalvalue &lt;dbl&gt;, lastsaleprice &lt;dbl&gt;, lastsaledate &lt;dttm&gt;, age &lt;dbl&gt;,
## #   med_age &lt;dbl&gt;, fp &lt;dbl&gt;, landuse &lt;dbl&gt;, insub &lt;dbl&gt;, remode &lt;dbl&gt;</code></pre>
<p>Logical tests</p>
<ul>
<li>x <strong>&lt;</strong> y: less than</li>
<li>x <strong>&gt;</strong> y: greater than</li>
<li>x <strong>==</strong> y: equal to</li>
<li>x <strong>&lt;=</strong> y: less than or equal to</li>
<li>y <strong>&gt;=</strong> y: greater than or equal to</li>
<li>x <strong>!=</strong> y: not equal to</li>
<li>x <strong>%in%</strong> y: is a member of</li>
<li><strong>is.na(</strong>x<strong>)</strong>: is NA</li>
<li><strong>!is.na(</strong>x<strong>)</strong>: is not NA</li>
</ul>
<pre class="r"><code>filter(homes, yearremodeled &gt; 0)</code></pre>
<pre><code>## # A tibble: 2,288 x 26
##   tmp   yearbuilt yearremodeled usecode condition finsqft cooling fp_num
##   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1 0070…      1920          1987 Single… Fair         2131 No Cen…      0
## 2 0080…      1850          1969 Single… Average      2024 No Cen…      5
## 3 0090…      1976          1983 Single… Average      1560 No Cen…      1
## 4 0090…      1823          1968 Single… Good         5226 Centra…      8
## 5 0140…      1975          1982 Single… Average      1520 No Cen…      1
## # … with 2,283 more rows, and 18 more variables: bedroom &lt;dbl&gt;,
## #   fullbath &lt;dbl&gt;, halfbath &lt;dbl&gt;, totalrooms &lt;dbl&gt;, city &lt;chr&gt;,
## #   zip &lt;dbl&gt;, lotsize &lt;dbl&gt;, landvalue &lt;dbl&gt;, improvementsvalue &lt;dbl&gt;,
## #   totalvalue &lt;dbl&gt;, lastsaleprice &lt;dbl&gt;, lastsaledate &lt;dttm&gt;, age &lt;dbl&gt;,
## #   med_age &lt;dbl&gt;, fp &lt;dbl&gt;, landuse &lt;dbl&gt;, insub &lt;dbl&gt;, remode &lt;dbl&gt;</code></pre>
<pre class="r"><code>filter(homes, bedroom == max(bedroom))</code></pre>
<pre><code>## # A tibble: 1 x 26
##   tmp   yearbuilt yearremodeled usecode condition finsqft cooling fp_num
##   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1 0760…      1973             0 Single… Good          940 Centra…      0
## # … with 18 more variables: bedroom &lt;dbl&gt;, fullbath &lt;dbl&gt;, halfbath &lt;dbl&gt;,
## #   totalrooms &lt;dbl&gt;, city &lt;chr&gt;, zip &lt;dbl&gt;, lotsize &lt;dbl&gt;,
## #   landvalue &lt;dbl&gt;, improvementsvalue &lt;dbl&gt;, totalvalue &lt;dbl&gt;,
## #   lastsaleprice &lt;dbl&gt;, lastsaledate &lt;dttm&gt;, age &lt;dbl&gt;, med_age &lt;dbl&gt;,
## #   fp &lt;dbl&gt;, landuse &lt;dbl&gt;, insub &lt;dbl&gt;, remode &lt;dbl&gt;</code></pre>
<pre class="r"><code>filter(homes, city %in% c(&quot;SCOTTSVILLE&quot;, &quot;CROZET&quot;))</code></pre>
<pre><code>## # A tibble: 4,095 x 26
##   tmp   yearbuilt yearremodeled usecode condition finsqft cooling fp_num
##   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1 0060…      2006             0 Single… Average      1922 Centra…      1
## 2 0060…      2003             0 Single… Average      1848 Centra…      0
## 3 0140…      1998             0 Single… Good         1244 Centra…      1
## 4 0150…      1997             0 Single… Average       924 No Cen…      0
## 5 0070…      1886             0 Single… Average      1861 No Cen…      1
## # … with 4,090 more rows, and 18 more variables: bedroom &lt;dbl&gt;,
## #   fullbath &lt;dbl&gt;, halfbath &lt;dbl&gt;, totalrooms &lt;dbl&gt;, city &lt;chr&gt;,
## #   zip &lt;dbl&gt;, lotsize &lt;dbl&gt;, landvalue &lt;dbl&gt;, improvementsvalue &lt;dbl&gt;,
## #   totalvalue &lt;dbl&gt;, lastsaleprice &lt;dbl&gt;, lastsaledate &lt;dttm&gt;, age &lt;dbl&gt;,
## #   med_age &lt;dbl&gt;, fp &lt;dbl&gt;, landuse &lt;dbl&gt;, insub &lt;dbl&gt;, remode &lt;dbl&gt;</code></pre>
<p>Boolean operators for multiple conditions</p>
<ul>
<li>a <strong>&amp;</strong> b: and</li>
<li>a <strong>|</strong> b: or</li>
<li><strong>xor(</strong>a,b<strong>)</strong>: exactly or</li>
<li><strong>!</strong>a: not</li>
</ul>
<pre class="r"><code>filter(homes, city == &quot;SCOTTSVILLE&quot; &amp; finsqft &gt; mean(finsqft))</code></pre>
<pre><code>## # A tibble: 256 x 26
##   tmp   yearbuilt yearremodeled usecode condition finsqft cooling fp_num
##   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1 1050…      1995             0 Single… Average      3326 Centra…      2
## 2 1150…      2004             0 Single… Average      2250 Centra…      1
## 3 1230…      2011             0 Single… Good         1966 Centra…      0
## 4 1240…      1993             0 Single… None         2008 Centra…      0
## 5 1310…      1998             0 Single… Good         2287 Centra…      1
## # … with 251 more rows, and 18 more variables: bedroom &lt;dbl&gt;,
## #   fullbath &lt;dbl&gt;, halfbath &lt;dbl&gt;, totalrooms &lt;dbl&gt;, city &lt;chr&gt;,
## #   zip &lt;dbl&gt;, lotsize &lt;dbl&gt;, landvalue &lt;dbl&gt;, improvementsvalue &lt;dbl&gt;,
## #   totalvalue &lt;dbl&gt;, lastsaleprice &lt;dbl&gt;, lastsaledate &lt;dttm&gt;, age &lt;dbl&gt;,
## #   med_age &lt;dbl&gt;, fp &lt;dbl&gt;, landuse &lt;dbl&gt;, insub &lt;dbl&gt;, remode &lt;dbl&gt;</code></pre>
</div>
<div id="arrange" class="section level2">
<h2>arrange()</h2>
<p>Order rows from smallest to largest values for designated column/s.</p>
<pre class="r"><code>arrange(homes, finsqft)</code></pre>
<pre><code>## # A tibble: 32,746 x 26
##   tmp   yearbuilt yearremodeled usecode condition finsqft cooling fp_num
##   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1 0380…      1952             0 Single… Poor          144 No Cen…      0
## 2 0410…         0             0 Single… None          221 No Cen…      0
## 3 0380…      1995             0 Single… Average       231 No Cen…      0
## 4 0620…      1982             0 Single… Average       261 No Cen…      1
## 5 0140…      1955             0 Single… Average       300 No Cen…      0
## # … with 3.274e+04 more rows, and 18 more variables: bedroom &lt;dbl&gt;,
## #   fullbath &lt;dbl&gt;, halfbath &lt;dbl&gt;, totalrooms &lt;dbl&gt;, city &lt;chr&gt;,
## #   zip &lt;dbl&gt;, lotsize &lt;dbl&gt;, landvalue &lt;dbl&gt;, improvementsvalue &lt;dbl&gt;,
## #   totalvalue &lt;dbl&gt;, lastsaleprice &lt;dbl&gt;, lastsaledate &lt;dttm&gt;, age &lt;dbl&gt;,
## #   med_age &lt;dbl&gt;, fp &lt;dbl&gt;, landuse &lt;dbl&gt;, insub &lt;dbl&gt;, remode &lt;dbl&gt;</code></pre>
<ul>
<li><strong>desc()</strong>: reverses order, largest to smallest.</li>
</ul>
<pre class="r"><code>arrange(homes, desc(finsqft))</code></pre>
<pre><code>## # A tibble: 32,746 x 26
##   tmp   yearbuilt yearremodeled usecode condition finsqft cooling fp_num
##   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1 0440…      1998             0 Single… Good         8982 Centra…      3
## 2 0450…      1940          1980 Single… Good         8897 Centra…      3
## 3 0860…      2015             0 Single… Average      8878 Centra…      3
## 4 0160…      2009             0 Single… Average      8849 Centra…      1
## 5 0430…      2008             0 Single… Excellent    8829 Centra…      3
## # … with 3.274e+04 more rows, and 18 more variables: bedroom &lt;dbl&gt;,
## #   fullbath &lt;dbl&gt;, halfbath &lt;dbl&gt;, totalrooms &lt;dbl&gt;, city &lt;chr&gt;,
## #   zip &lt;dbl&gt;, lotsize &lt;dbl&gt;, landvalue &lt;dbl&gt;, improvementsvalue &lt;dbl&gt;,
## #   totalvalue &lt;dbl&gt;, lastsaleprice &lt;dbl&gt;, lastsaledate &lt;dttm&gt;, age &lt;dbl&gt;,
## #   med_age &lt;dbl&gt;, fp &lt;dbl&gt;, landuse &lt;dbl&gt;, insub &lt;dbl&gt;, remode &lt;dbl&gt;</code></pre>
</div>
<div id="and-more" class="section level2">
<h2>and more…</h2>
<center>
<p><span class="math inline">\(\color{green}{\text{slice()}}\)</span> - extract <span class="math inline">\(\color{green}{\text{rows}}\)</span> using index(es)</p>
<p><span class="math inline">\(\color{green}{\text{distinct()}}\)</span> - filter for unique <span class="math inline">\(\color{green}{\text{rows}}\)</span></p>
<p><span class="math inline">\(\color{green}{\text{sample_n()/sample_frac()}}\)</span> - randomly sample <span class="math inline">\(\color{green}{\text{rows}}\)</span></p>
</center>
</div>
</div>
<div id="pipes" class="section level1">
<h1>Pipes!</h1>
<p>The <code>%&gt;%</code> is the pipe operator. It passes the result on left into the first argument of the function on the right, or “pipes” the previous output as the input for the next function. Read it in your head as <em>then</em></p>
<p>For example, if we just want the <code>totalvalue</code> and <code>lotsize</code> for homes in Scottsville arranged in descending order of <code>lotsize</code>, without the pipe, we’d:</p>
<pre class="r"><code>scottsville &lt;- filter(homes, city == &quot;SCOTTSVILLE&quot;)
scottsville &lt;- select(scottsville, totalvalue, lotsize)
scottsville &lt;- arrange(scottsville, desc(lotsize))
scottsville</code></pre>
<pre><code>## # A tibble: 1,077 x 2
##   totalvalue lotsize
##        &lt;dbl&gt;   &lt;dbl&gt;
## 1    2156700    612.
## 2    2665700    511.
## 3    2352200    365.
## 4    2800800    315.
## 5     892300    294.
## # … with 1,072 more rows</code></pre>
<p>With the pipe, we can start with homes, <em>then</em> filter only the rows for Scottsville, <em>then</em> select only the variables <code>totalvalue</code> and <code>lotsize</code>, <em>then</em> arrange the rows by descending order of <code>lotsize</code>.</p>
<pre class="r"><code>homes %&gt;% 
  filter(city == &quot;SCOTTSVILLE&quot;) %&gt;% 
  select(totalvalue, lotsize) %&gt;% 
  arrange(desc(lotsize))</code></pre>
<pre><code>## # A tibble: 1,077 x 2
##   totalvalue lotsize
##        &lt;dbl&gt;   &lt;dbl&gt;
## 1    2156700    612.
## 2    2665700    511.
## 3    2352200    365.
## 4    2800800    315.
## 5     892300    294.
## # … with 1,072 more rows</code></pre>
<div id="keyboard-shortcut" class="section level2">
<h2>Keyboard Shortcut!</h2>
<ul>
<li>Mac: cmd + shift + m</li>
<li>Windows: ctrl + shift + m</li>
</ul>
</div>
</div>
<div id="dplyr-deriving-data" class="section level1">
<h1>dplyr: Deriving data</h1>
<center>
<p><span class="math inline">\(\color{blue}{\text{mutate()}}\)</span> - create new <span class="math inline">\(\color{blue}{\text{variables}}\)</span></p>
<p><span class="math inline">\(\color{blue}{\text{summarize()}}\)</span> - summarize <span class="math inline">\(\color{blue}{\text{variables}}\)</span></p>
<p><span class="math inline">\(\color{green}{\text{group_by()}}\)</span> - group <span class="math inline">\(\color{green}{\text{rows}}\)</span></p>
</center>
<div id="mutate" class="section level2">
<h2>mutate()</h2>
<p>Create new columns.</p>
<pre class="r"><code>homes %&gt;% 
  mutate(value_sqft = totalvalue/finsqft) %&gt;% 
  select(yearbuilt, condition, finsqft, totalvalue, city, value_sqft) %&gt;% 
  arrange(desc(value_sqft))</code></pre>
<pre><code>## # A tibble: 32,746 x 6
##   yearbuilt condition finsqft totalvalue city            value_sqft
##       &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;
## 1         0 Average      1210   10351200 KESWICK              8555.
## 2      1935 Average       475    3931500 OTHER                8277.
## 3      1962 Average      1590   11352300 CHARLOTTESVILLE      7140.
## 4      1934 Average       600    3931500 OTHER                6552.
## 5         0 Fair          731    4153300 OTHER                5682.
## # … with 3.274e+04 more rows</code></pre>
<p>We can create new variables as functions of other variables (ratios, conditions, ranks, etc.). We can mutate multiple variables in the same command.</p>
<pre class="r"><code>homes %&gt;% 
  mutate(value_sqft = totalvalue/finsqft,
         remodel = if_else(yearremodeled &gt; 0, 1, 0)) %&gt;% 
  select(value_sqft, remodel, city) %&gt;% 
  arrange(value_sqft)</code></pre>
<pre><code>## # A tibble: 32,746 x 3
##   value_sqft remodel city           
##        &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;          
## 1       7.62       0 CHARLOTTESVILLE
## 2      10.8        0 ESMONT         
## 3      11.0        0 OTHER          
## 4      12.1        0 OTHER          
## 5      13.7        0 OTHER          
## # … with 3.274e+04 more rows</code></pre>
<ul>
<li>mutate based on condition</li>
</ul>
<p><code>if_else(condition, value_if_true, value_if_false, value_if_na)</code></p>
<ul>
<li>vectorize multiple <code>if_else()</code></li>
</ul>
<p><code>case_when(condition1 ~ value1, condition2 ~ value2, condition3 ~ value3, TRUE ~ value_everything_else)</code></p>
</div>
<div id="summarize" class="section level2">
<h2>summarize()</h2>
<p>Compute table of summaries.</p>
<pre class="r"><code>homes %&gt;% 
  filter(yearbuilt &gt; 0) %&gt;% 
  summarize(oldest = min(yearbuilt), 
            newest = max(yearbuilt), 
            total = n())</code></pre>
<pre><code>## # A tibble: 1 x 3
##   oldest newest total
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
## 1   1668   2016 32299</code></pre>
<p><code>summarize</code> takes a single vector as input (a variable) and returns a single value as output (the requested summary of the variable).</p>
<p>Summary functions include</p>
<ul>
<li><strong>first()</strong>: first value</li>
<li><strong>last()</strong>: last value</li>
<li><strong>nth(</strong>.x, <strong>n)</strong>: nth value</li>
<li><strong>n()</strong>: number of values</li>
<li><strong>n_distinct()</strong>: number of distinct values</li>
<li><strong>min()</strong>: minimum value</li>
<li><strong>max()</strong>: maximum value</li>
<li><strong>mean()</strong>: mean value</li>
<li><strong>median()</strong>: median value</li>
<li><strong>var()</strong>: variance</li>
<li><strong>sd()</strong>: standard deviation</li>
<li><strong>IQR()</strong>: interquartile range</li>
</ul>
<p>That’s not always interesting on it’s own, but when combined with <code>group_by</code>, it is powerful!</p>
</div>
<div id="group_by" class="section level2">
<h2>group_by()</h2>
<p>Groups cases by common values of one or more columns.</p>
<pre class="r"><code>homes %&gt;% 
  filter(yearbuilt &gt; 0) %&gt;% 
  group_by(city) %&gt;% 
  summarize(oldest = min(yearbuilt), 
            newest = max(yearbuilt), 
            total = n())</code></pre>
<pre><code>## # A tibble: 10 x 4
##    city            oldest newest total
##    &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
##  1 AFTON             1756   2015   495
##  2 BARBOURSVILLE     1800   2016   405
##  3 CHARLOTTESVILLE   1668   2016 21006
##  4 CROZET            1700   2016  2978
##  5 EARLYSVILLE       1735   2016  1909
##  6 ESMONT            1740   2016   478
##  7 KESWICK           1724   2016  1574
##  8 NORTH GARDEN      1700   2016   603
##  9 OTHER             1730   2016  1811
## 10 SCOTTSVILLE       1732   2016  1040</code></pre>
</div>
<div id="and-more-1" class="section level2">
<h2>and more…</h2>
<center>
<p><span class="math inline">\(\color{blue}{\text{tally()}}\)</span> - short hand for <code>summarize(n())</code></p>
<p><span class="math inline">\(\color{blue}{\text{count()}}\)</span> - short hand for <code>group_by()</code> + <code>tally()</code></p>
<p><span class="math inline">\(\color{blue}{\text{summarize_all()}}\)</span> - apply summary function to all <span class="math inline">\(\color{blue}{\text{variables}}\)</span></p>
<p><span class="math inline">\(\color{blue}{\text{summarize_at()}}\)</span> - apply summary function to selected <span class="math inline">\(\color{blue}{\text{variables}}\)</span></p>
<p><span class="math inline">\(\color{blue}{\text{rename()}}\)</span> - rename <span class="math inline">\(\color{blue}{\text{variables}}\)</span></p>
<p><span class="math inline">\(\color{blue}{\text{recode()}}\)</span> - modify values of <span class="math inline">\(\color{blue}{\text{variables}}\)</span></p>
</center>
</div>
</div>
<div id="factors" class="section level1">
<h1>Factors</h1>
<p>Factors are variables which take on a limited number of values, aka categorical variables. In R, factors are stored as a vector of integer values with the corresponding set of character values you’ll see when displayed (colloquially, labels; in R, levels).</p>
<pre class="r"><code>homes %&gt;% count(condition) # currently a character</code></pre>
<pre><code>## # A tibble: 7 x 2
##   condition       n
##   &lt;chr&gt;       &lt;int&gt;
## 1 Average     17346
## 2 Excellent    2296
## 3 Fair          917
## 4 Good        11679
## 5 None          317
## 6 Poor          175
## 7 Substandard    16</code></pre>
<pre class="r"><code>homes %&gt;% 
  mutate(condition = factor(condition)) %&gt;% # make a factor
  count(condition)</code></pre>
<pre><code>## # A tibble: 7 x 2
##   condition       n
##   &lt;fct&gt;       &lt;int&gt;
## 1 Average     17346
## 2 Excellent    2296
## 3 Fair          917
## 4 Good        11679
## 5 None          317
## 6 Poor          175
## 7 Substandard    16</code></pre>
<pre class="r"><code># assert the ordering of the factor levels
cond_levels &lt;- c(&quot;Excellent&quot;, &quot;Good&quot;, &quot;Average&quot;, &quot;Fair&quot;, &quot;Poor&quot;, &quot;Substandard&quot;)
homes %&gt;% 
  mutate(condition = factor(condition, levels = cond_levels)) %&gt;% 
  count(condition)</code></pre>
<pre><code>## Warning: Factor `condition` contains implicit NA, consider using
## `forcats::fct_explicit_na`</code></pre>
<pre><code>## # A tibble: 7 x 2
##   condition       n
##   &lt;fct&gt;       &lt;int&gt;
## 1 Excellent    2296
## 2 Good        11679
## 3 Average     17346
## 4 Fair          917
## 5 Poor          175
## 6 Substandard    16
## 7 &lt;NA&gt;          317</code></pre>
<div id="forcats" class="section level2">
<h2>forcats</h2>
<p>The <a href="https://forcats.tidyverse.org/"><code>forcats</code></a> package, part of the <code>tidyverse</code>, provides helper functions for working with factors. Including</p>
<ul>
<li><strong>fct_infreq()</strong>: reorder factor levels by frequency of levels</li>
<li><strong>fct_reorder()</strong>: reorder factor levels by another variable</li>
<li><strong>fct_relevel()</strong>: change order of factor levels by hand</li>
<li><strong>fct_recode()</strong>: change factor levels by hand</li>
<li><strong>fct_collapse()</strong>: collapse factor levels into defined groups</li>
<li><strong>fct_lump()</strong>: collapse least/most frequent levels of factor into “other”</li>
</ul>
</div>
</div>
<div id="dplyr-joins" class="section level1">
<h1>dplyr: Joins</h1>
<p>Often, a single data set won’t contain all of the information or attributes necessary to address your questions. Instead, we have to join or combine multiple data sets. The Albermarle homes data came from multiple data tables; and we could consider adding data from additional sources to answer yet more questions.</p>
<p>The variables used to connect data sets are called keys. A key (a single variable or multiple variables) uniquely identifies an observation.</p>
<center>
<p><span class="math inline">\(\color{blue}{\text{Mutating joins}}\)</span> use information from one data set to add <span class="math inline">\(\color{blue}{\text{variables}}\)</span> to another data set (like <span class="math inline">\(\color{blue}{\text{mutate())}}\)</span>.</p>
<p><span class="math inline">\(\color{green}{\text{Filtering joins}}\)</span> use information from one data set to extract <span class="math inline">\(\color{green}{\text{rows}}\)</span> from another data set (like <span class="math inline">\(\color{green}{\text{filter())}}\)</span>.</p>
</center>
<p>The syntax is always <code>name_join(x, y, by = &quot;key&quot;)</code></p>
<div id="mutating-joins" class="section level2">
<h2>mutating joins</h2>
<p>A visual explanation is in Grolemund’s and Wickham’s <a href="https://r4ds.had.co.nz/relational-data.html#understanding-joins">R for Data Science</a>.</p>
<ul>
<li><strong>full_join()</strong>: keeps all observations in x and y</li>
<li><strong>left_join()</strong>: keeps all observations in x</li>
<li><strong>right_join()</strong>: keeps all observations in y</li>
<li><strong>inner_join()</strong>: keeps observations in both x and y</li>
</ul>
</div>
<div id="filtering-joins" class="section level2">
<h2>filtering joins</h2>
<p>Filtering joins match observations in the same way, but rather than adding variables, it extracts observations.</p>
<ul>
<li><strong>semi_join()</strong>: keeps all observations in x that have a match in y</li>
<li><strong>anti_join()</strong>: drops all observations in x that have a match in y</li>
</ul>
</div>
</div>
<div id="resources" class="section level1">
<h1>Resources</h1>
<ul>
<li>RStudio’s <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">dplyr cheat sheet</a></li>
<li>Garrett Grolemund and Hadley Wickham. 2018. <a href="https://r4ds.had.co.nz/">R for Data Science</a>.</li>
<li><a href="intror.html#finding_help_online">Finding Help</a> resources from Introduction to R</li>
</ul>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Way to be classist NYT…<a href="#fnref1">↩</a></p></li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
